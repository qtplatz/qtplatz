<?xml version="1.0" encoding="utf-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
    <?include version.wxi ?>
    <Product Id="*" Name="QtPlatz $(var.ProductVersion)" Language="1033" Version="$(var.ProductVersion)" Manufacturer="MS-Cheminformatics LLC" UpgradeCode="cf1f5024-a587-488a-beee-fd248ed76e4e">
        <Package Id="*" Keywords="installer" Platform="x64" Manufacturer="MS-Cheminformatics LLC" InstallerVersion="200" Compressed="yes" InstallScope="perMachine" />
        <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
        <Media Id="1" Cabinet="Cab1.cab" EmbedCab="yes" />
        <Feature Id="ProductFeature" Title="QtPlatz Mass Spectrometry Software" Level="1">
            <ComponentGroupRef Id="LicenseComponents" />
            <ComponentGroupRef Id="RDKitComponents" />
            <ComponentGroupRef Id="QtComponents" />
            <ComponentGroupRef Id="QtPlatformsComponents" />
            <ComponentGroupRef Id="QtCreatorComponents" />
            <ComponentGroupRef Id="QtPlatzComponents" />
            <ComponentGroupRef Id="SPCFileComponents" />
            <ComponentGroupRef Id="XSDComponents" />
            <ComponentGroupRef Id="TAOComponents" />
            <ComponentGroupRef Id="MicrosoftComponents" />
            <ComponentGroupRef Id="PluginComponents" />
            <ComponentGroupRef Id="InfiTOFComponents" />
            <ComponentGroupRef Id="BrukerComponents" />
            <ComponentGroupRef Id="ApplicationProgramsFolder" />
        </Feature>
        <UI />
    </Product>
    <Fragment>
        <Directory Id="TARGETDIR" Name="SourceDir">
            <Directory Id="ProgramFiles64Folder">
                <Directory Id="INSTALLFOLDER" Name="QtPlatz">
                    <Directory Id="BIN" Name="bin" />
                    <Directory Id="LIB" Name="lib">
                        <Directory Id="LIB_QTPLATZ" Name="qtplatz">
                            <Directory Id="LIB_PLUGINS" Name="plugins">
                                <Directory Id="PLUGINS_MSCHEMINFORMATICS" Name="MS-Cheminformatics" />
                                <Directory Id="PLUGINS_QTPROJECT" Name="QtProject" />
                                <Directory Id="PLUGINS_XSD" Name="xsd" />
                            </Directory>
                        </Directory>
                    </Directory>
                    <Directory Id="LIB_RDKIT" Name="rdkit" />
                    <Directory Id="LIB_BRUKER" Name="Bruker" />
                    <Directory Id="PLUGINS" Name="plugins">
                        <Directory Id="PLATFORMS" Name="platforms" />
                    </Directory>
                </Directory>
            </Directory>
            <Directory Id="ProgramMenuFolder">
                <Directory Id="ApplicationProgramsFolder" Name="QtPlatz Mass Spectrometry Software" />
            </Directory>
        </Directory>
    </Fragment>
    <?define TOP = "../../.." ?>
    <?define InMSCheminfo = "$(var.TOP)/lib/qtplatz/plugins/MS-Cheminformatics" ?>
    <?define InQt         = "$(env.QTDIR)" ?>
    <?define InVC110      = "$(env.VCINSTALLDIR)/redist/x64/Microsoft.VC110.CRT" ?>
    <?define InTAOLib     = "$(env.ACE_ROOT)/lib" ?>
    <?define InTAOBin     = "$(env.ACE_ROOT)/bin" ?>
    <Fragment>
        <ComponentGroup Id="LicenseComponents" Directory="INSTALLFOLDER">
            <Component Id="license.txt" Guid="85B42502-7D63-4FCF-9737-3660138FA88B" Win64="yes">
                <File Id="license.txt" Source="$(var.TOP)/license.txt" ProcessorArchitecture="x64" />
            </Component>
        </ComponentGroup>
        <?include rdkit_components.wxi ?>
        <?include qt_opengl_components.wxi ?>
        <?include qt_platforms_components.wxi ?>
        <?include qt_creator_components.wxi ?>
        <?include qtplatz_components.wxi ?>
        <ComponentGroup Id="XSDComponents" Directory="PLUGINS_XSD">
            <Component Id="config.xsd" Guid="830AB06B-0540-4A65-8B38-D1A7365F0918" Win64="yes">
                <File Id="config.xsd" Source="$(var.TOP)/src/plugins/xsd/config.xsd" ProcessorArchitecture="x64" />
            </Component>
        </ComponentGroup>
        <?include qtplatz_plugin_components.wxi ?>
        <?include spcfile_components.wxi ?>
        <?include infitof_components.wxi ?>
        <?include tao_components.wxi ?>
        <?include microsoft_components.wxi ?>
        <?include bruker.wxi ?>
    </Fragment>
    <Fragment>
        <ComponentGroup Id="ApplicationProgramsFolder" Directory="ApplicationProgramsFolder">
            <Component Id="ApplicationShortcut" Guid="94DB95AE-A0EB-4BFC-8894-C7F16D7E107D">
                <Shortcut Id="ApplicationStartMenuShortcut" Name="QtPlatz Mass Spectrometry" Target="[#qtplatz.exe]" WorkingDirectory="APPLICATIONROOTDIRECTORY" />
                <RemoveFolder Id="INSTALLFOLDER" On="uninstall" />
                <RegistryValue Root="HKCU" Key="Software\MS-Cheminformatics\QtPlatz" Name="installed" Value="1" Type="integer" KeyPath="yes" />
            </Component>
        </ComponentGroup>
    </Fragment>
</Wix>